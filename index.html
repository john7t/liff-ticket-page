<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>取號驗證</title>
  <script src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>
  <style>
    body { font-family: sans-serif; text-align: center; margin-top: 80px; }
    input { padding: 10px; font-size: 16px; margin: 10px; width: 200px; }
    button { padding: 10px 20px; font-size: 16px; }
  </style>
</head>
<body>
  <h2>請輸入驗證碼</h2>
  <input id="code" type="text" maxlength="4" placeholder="四位數驗證碼"/>
  <br>
  <button onclick="submitCode()">確認</button>
  <p id="result"></p>

  <script>
    const API_URL = "https://script.google.com/macros/s/AKfycbzgn1GP9NOv7dEA3-50B3eaU8QcLoDULVPpoCYFfVA/exec";
    const LIFF_ID = "2007223613-5OL4mpnA";

    async function submitCode() {
      const code = document.getElementById("code").value;
      document.getElementById("result").innerText = "驗證中...";
      await liff.init({ liffId: LIFF_ID });
      const profile = await liff.getProfile();
      const userId = profile.userId;

      const res = await fetch(API_URL, {
        method: 'POST',
        body: JSON.stringify({
          action: "claimTicket",
          code: code,
          userId: userId
        }),
        headers: {
          'Content-Type': 'application/json'
        }
      });
      const data = await res.json();
      if (data.status === 'success') {
        document.getElementById("result").innerText = `✅ 您的號碼是 ${data.number}`;
      } else {
        document.getElementById("result").innerText = `❌ ${data.message}`;
      }
    }
  </script>
</body>
</html>
